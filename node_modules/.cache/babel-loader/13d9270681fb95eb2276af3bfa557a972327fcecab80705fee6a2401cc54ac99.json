{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar dayjs = require('dayjs');\nrequire('../../../../constants/index.js');\nrequire('../../../../hooks/index.js');\nrequire('../../../../utils/index.js');\nvar panelTimePicker = require('../props/panel-time-picker.js');\nvar useTimePanel = require('../composables/use-time-panel.js');\nvar useTimePicker = require('../composables/use-time-picker.js');\nvar basicTimeSpinner = require('./basic-time-spinner.js');\nvar pluginVue_exportHelper = require('../../../../_virtual/plugin-vue_export-helper.js');\nvar index = require('../../../../hooks/use-namespace/index.js');\nvar index$1 = require('../../../../hooks/use-locale/index.js');\nvar types = require('../../../../utils/types.js');\nvar aria = require('../../../../constants/aria.js');\nfunction _interopDefaultLegacy(e) {\n  return e && typeof e === 'object' && 'default' in e ? e : {\n    'default': e\n  };\n}\nvar dayjs__default = /*#__PURE__*/_interopDefaultLegacy(dayjs);\nconst _sfc_main = /* @__PURE__ */vue.defineComponent({\n  __name: \"panel-time-pick\",\n  props: panelTimePicker.panelTimePickerProps,\n  emits: [\"pick\", \"select-range\", \"set-picker-option\"],\n  setup(__props, {\n    emit\n  }) {\n    const props = __props;\n    const pickerBase = vue.inject(\"EP_PICKER_BASE\");\n    const {\n      arrowControl,\n      disabledHours,\n      disabledMinutes,\n      disabledSeconds,\n      defaultValue\n    } = pickerBase.props;\n    const {\n      getAvailableHours,\n      getAvailableMinutes,\n      getAvailableSeconds\n    } = useTimePicker.buildAvailableTimeSlotGetter(disabledHours, disabledMinutes, disabledSeconds);\n    const ns = index.useNamespace(\"time\");\n    const {\n      t,\n      lang\n    } = index$1.useLocale();\n    const selectionRange = vue.ref([0, 2]);\n    const oldValue = useTimePicker.useOldValue(props);\n    const transitionName = vue.computed(() => {\n      return types.isUndefined(props.actualVisible) ? `${ns.namespace.value}-zoom-in-top` : \"\";\n    });\n    const showSeconds = vue.computed(() => {\n      return props.format.includes(\"ss\");\n    });\n    const amPmMode = vue.computed(() => {\n      if (props.format.includes(\"A\")) return \"A\";\n      if (props.format.includes(\"a\")) return \"a\";\n      return \"\";\n    });\n    const isValidValue = _date => {\n      const parsedDate = dayjs__default[\"default\"](_date).locale(lang.value);\n      const result = getRangeAvailableTime(parsedDate);\n      return parsedDate.isSame(result);\n    };\n    const handleCancel = () => {\n      emit(\"pick\", oldValue.value, false);\n    };\n    const handleConfirm = (visible = false, first = false) => {\n      if (first) return;\n      emit(\"pick\", props.parsedValue, visible);\n    };\n    const handleChange = _date => {\n      if (!props.visible) {\n        return;\n      }\n      const result = getRangeAvailableTime(_date).millisecond(0);\n      emit(\"pick\", result, true);\n    };\n    const setSelectionRange = (start, end) => {\n      emit(\"select-range\", start, end);\n      selectionRange.value = [start, end];\n    };\n    const changeSelectionRange = step => {\n      const list = [0, 3].concat(showSeconds.value ? [6] : []);\n      const mapping = [\"hours\", \"minutes\"].concat(showSeconds.value ? [\"seconds\"] : []);\n      const index = list.indexOf(selectionRange.value[0]);\n      const next = (index + step + list.length) % list.length;\n      timePickerOptions[\"start_emitSelectRange\"](mapping[next]);\n    };\n    const handleKeydown = event => {\n      const code = event.code;\n      const {\n        left,\n        right,\n        up,\n        down\n      } = aria.EVENT_CODE;\n      if ([left, right].includes(code)) {\n        const step = code === left ? -1 : 1;\n        changeSelectionRange(step);\n        event.preventDefault();\n        return;\n      }\n      if ([up, down].includes(code)) {\n        const step = code === up ? -1 : 1;\n        timePickerOptions[\"start_scrollDown\"](step);\n        event.preventDefault();\n        return;\n      }\n    };\n    const {\n      timePickerOptions,\n      onSetOption,\n      getAvailableTime\n    } = useTimePanel.useTimePanel({\n      getAvailableHours,\n      getAvailableMinutes,\n      getAvailableSeconds\n    });\n    const getRangeAvailableTime = date => {\n      return getAvailableTime(date, props.datetimeRole || \"\", true);\n    };\n    const parseUserInput = value => {\n      if (!value) return null;\n      return dayjs__default[\"default\"](value, props.format).locale(lang.value);\n    };\n    const formatToString = value => {\n      if (!value) return null;\n      return value.format(props.format);\n    };\n    const getDefaultValue = () => {\n      return dayjs__default[\"default\"](defaultValue).locale(lang.value);\n    };\n    emit(\"set-picker-option\", [\"isValidValue\", isValidValue]);\n    emit(\"set-picker-option\", [\"formatToString\", formatToString]);\n    emit(\"set-picker-option\", [\"parseUserInput\", parseUserInput]);\n    emit(\"set-picker-option\", [\"handleKeydownInput\", handleKeydown]);\n    emit(\"set-picker-option\", [\"getRangeAvailableTime\", getRangeAvailableTime]);\n    emit(\"set-picker-option\", [\"getDefaultValue\", getDefaultValue]);\n    return (_ctx, _cache) => {\n      return vue.openBlock(), vue.createBlock(vue.Transition, {\n        name: vue.unref(transitionName)\n      }, {\n        default: vue.withCtx(() => [_ctx.actualVisible || _ctx.visible ? (vue.openBlock(), vue.createElementBlock(\"div\", {\n          key: 0,\n          class: vue.normalizeClass(vue.unref(ns).b(\"panel\"))\n        }, [vue.createElementVNode(\"div\", {\n          class: vue.normalizeClass([vue.unref(ns).be(\"panel\", \"content\"), {\n            \"has-seconds\": vue.unref(showSeconds)\n          }])\n        }, [vue.createVNode(basicTimeSpinner[\"default\"], {\n          ref: \"spinner\",\n          role: _ctx.datetimeRole || \"start\",\n          \"arrow-control\": vue.unref(arrowControl),\n          \"show-seconds\": vue.unref(showSeconds),\n          \"am-pm-mode\": vue.unref(amPmMode),\n          \"spinner-date\": _ctx.parsedValue,\n          \"disabled-hours\": vue.unref(disabledHours),\n          \"disabled-minutes\": vue.unref(disabledMinutes),\n          \"disabled-seconds\": vue.unref(disabledSeconds),\n          onChange: handleChange,\n          onSetOption: vue.unref(onSetOption),\n          onSelectRange: setSelectionRange\n        }, null, 8, [\"role\", \"arrow-control\", \"show-seconds\", \"am-pm-mode\", \"spinner-date\", \"disabled-hours\", \"disabled-minutes\", \"disabled-seconds\", \"onSetOption\"])], 2), vue.createElementVNode(\"div\", {\n          class: vue.normalizeClass(vue.unref(ns).be(\"panel\", \"footer\"))\n        }, [vue.createElementVNode(\"button\", {\n          type: \"button\",\n          class: vue.normalizeClass([vue.unref(ns).be(\"panel\", \"btn\"), \"cancel\"]),\n          onClick: handleCancel\n        }, vue.toDisplayString(vue.unref(t)(\"el.datepicker.cancel\")), 3), vue.createElementVNode(\"button\", {\n          type: \"button\",\n          class: vue.normalizeClass([vue.unref(ns).be(\"panel\", \"btn\"), \"confirm\"]),\n          onClick: _cache[0] || (_cache[0] = $event => handleConfirm())\n        }, vue.toDisplayString(vue.unref(t)(\"el.datepicker.confirm\")), 3)], 2)], 2)) : vue.createCommentVNode(\"v-if\", true)]),\n        _: 1\n      }, 8, [\"name\"]);\n    };\n  }\n});\nvar TimePickPanel = /* @__PURE__ */pluginVue_exportHelper[\"default\"](_sfc_main, [[\"__file\", \"/home/runner/work/element-plus/element-plus/packages/components/time-picker/src/time-picker-com/panel-time-pick.vue\"]]);\nexports[\"default\"] = TimePickPanel;","map":{"version":3,"mappings":"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","names":["inject","arrowControl","disabledHours","disabledMinutes","disabledSeconds","defaultValue","pickerBase","getAvailableHours","getAvailableMinutes","getAvailableSeconds","buildAvailableTimeSlotGetter","useNamespace","t","lang","useLocale","selectionRange","useOldValue","props","computed","isUndefined","namespace","value","format","_date","parsedDate","dayjs","getRangeAvailableTime","isSame","result","handleCancel","emit","oldValue","handleConfirm","visible","first","millisecond","start","end","step","list","showSeconds","mapping","index","indexOf","next","length","timePickerOptions","event","code","left","right","up","down","changeSelectionRange","preventDefault","onSetOption","getAvailableTime","useTimePanel","date","getDefaultValue"],"sources":["../../../../../../../packages/components/time-picker/src/time-picker-com/panel-time-pick.vue"],"sourcesContent":["<template>\n  <transition :name=\"transitionName\">\n    <div v-if=\"actualVisible || visible\" :class=\"ns.b('panel')\">\n      <div :class=\"[ns.be('panel', 'content'), { 'has-seconds': showSeconds }]\">\n        <time-spinner\n          ref=\"spinner\"\n          :role=\"datetimeRole || 'start'\"\n          :arrow-control=\"arrowControl\"\n          :show-seconds=\"showSeconds\"\n          :am-pm-mode=\"amPmMode\"\n          :spinner-date=\"(parsedValue as any)\"\n          :disabled-hours=\"disabledHours\"\n          :disabled-minutes=\"disabledMinutes\"\n          :disabled-seconds=\"disabledSeconds\"\n          @change=\"handleChange\"\n          @set-option=\"onSetOption\"\n          @select-range=\"setSelectionRange\"\n        />\n      </div>\n      <div :class=\"ns.be('panel', 'footer')\">\n        <button\n          type=\"button\"\n          :class=\"[ns.be('panel', 'btn'), 'cancel']\"\n          @click=\"handleCancel\"\n        >\n          {{ t('el.datepicker.cancel') }}\n        </button>\n        <button\n          type=\"button\"\n          :class=\"[ns.be('panel', 'btn'), 'confirm']\"\n          @click=\"handleConfirm()\"\n        >\n          {{ t('el.datepicker.confirm') }}\n        </button>\n      </div>\n    </div>\n  </transition>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, inject, ref } from 'vue'\nimport dayjs from 'dayjs'\nimport { EVENT_CODE } from '@element-plus/constants'\nimport { useLocale, useNamespace } from '@element-plus/hooks'\nimport { isUndefined } from '@element-plus/utils'\nimport { panelTimePickerProps } from '../props/panel-time-picker'\nimport { useTimePanel } from '../composables/use-time-panel'\nimport {\n  buildAvailableTimeSlotGetter,\n  useOldValue,\n} from '../composables/use-time-picker'\nimport TimeSpinner from './basic-time-spinner.vue'\n\nimport type { Dayjs } from 'dayjs'\n\nconst props = defineProps(panelTimePickerProps)\nconst emit = defineEmits(['pick', 'select-range', 'set-picker-option'])\n\n// Injections\nconst pickerBase = inject('EP_PICKER_BASE') as any\nconst {\n  arrowControl,\n  disabledHours,\n  disabledMinutes,\n  disabledSeconds,\n  defaultValue,\n} = pickerBase.props\nconst { getAvailableHours, getAvailableMinutes, getAvailableSeconds } =\n  buildAvailableTimeSlotGetter(disabledHours, disabledMinutes, disabledSeconds)\n\nconst ns = useNamespace('time')\nconst { t, lang } = useLocale()\n// data\nconst selectionRange = ref([0, 2])\nconst oldValue = useOldValue(props)\n// computed\nconst transitionName = computed(() => {\n  return isUndefined(props.actualVisible)\n    ? `${ns.namespace.value}-zoom-in-top`\n    : ''\n})\nconst showSeconds = computed(() => {\n  return props.format.includes('ss')\n})\nconst amPmMode = computed(() => {\n  if (props.format.includes('A')) return 'A'\n  if (props.format.includes('a')) return 'a'\n  return ''\n})\n// method\nconst isValidValue = (_date: Dayjs) => {\n  const parsedDate = dayjs(_date).locale(lang.value)\n  const result = getRangeAvailableTime(parsedDate)\n  return parsedDate.isSame(result)\n}\nconst handleCancel = () => {\n  emit('pick', oldValue.value, false)\n}\nconst handleConfirm = (visible = false, first = false) => {\n  if (first) return\n  emit('pick', props.parsedValue, visible)\n}\nconst handleChange = (_date: Dayjs) => {\n  // visible avoids edge cases, when use scrolls during panel closing animation\n  if (!props.visible) {\n    return\n  }\n  const result = getRangeAvailableTime(_date).millisecond(0)\n  emit('pick', result, true)\n}\n\nconst setSelectionRange = (start: number, end: number) => {\n  emit('select-range', start, end)\n  selectionRange.value = [start, end]\n}\n\nconst changeSelectionRange = (step: number) => {\n  const list = [0, 3].concat(showSeconds.value ? [6] : [])\n  const mapping = ['hours', 'minutes'].concat(\n    showSeconds.value ? ['seconds'] : []\n  )\n  const index = list.indexOf(selectionRange.value[0])\n  const next = (index + step + list.length) % list.length\n  timePickerOptions['start_emitSelectRange'](mapping[next])\n}\n\nconst handleKeydown = (event: KeyboardEvent) => {\n  const code = event.code\n\n  const { left, right, up, down } = EVENT_CODE\n\n  if ([left, right].includes(code)) {\n    const step = code === left ? -1 : 1\n    changeSelectionRange(step)\n    event.preventDefault()\n    return\n  }\n\n  if ([up, down].includes(code)) {\n    const step = code === up ? -1 : 1\n    timePickerOptions['start_scrollDown'](step)\n    event.preventDefault()\n    return\n  }\n}\n\nconst { timePickerOptions, onSetOption, getAvailableTime } = useTimePanel({\n  getAvailableHours,\n  getAvailableMinutes,\n  getAvailableSeconds,\n})\n\nconst getRangeAvailableTime = (date: Dayjs) => {\n  return getAvailableTime(date, props.datetimeRole || '', true)\n}\n\nconst parseUserInput = (value: Dayjs) => {\n  if (!value) return null\n  return dayjs(value, props.format).locale(lang.value)\n}\n\nconst formatToString = (value: Dayjs) => {\n  if (!value) return null\n  return value.format(props.format)\n}\n\nconst getDefaultValue = () => {\n  return dayjs(defaultValue).locale(lang.value)\n}\n\nemit('set-picker-option', ['isValidValue', isValidValue])\nemit('set-picker-option', ['formatToString', formatToString])\nemit('set-picker-option', ['parseUserInput', parseUserInput])\nemit('set-picker-option', ['handleKeydownInput', handleKeydown])\nemit('set-picker-option', ['getRangeAvailableTime', getRangeAvailableTime])\nemit('set-picker-option', ['getDefaultValue', getDefaultValue])\n</script>\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}